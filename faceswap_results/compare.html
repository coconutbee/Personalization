<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamID-V ‰∫∫ËáâÁΩÆÊèõÊïàÊûúÊØîËºÉ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            font-weight: 600;
            color: #555;
            font-size: 0.9em;
        }

        select, button {
            padding: 12px 20px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        select {
            background: white;
            color: #333;
            min-width: 150px;
        }

        select:hover {
            border-color: #764ba2;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .view-toggle {
            display: flex;
            gap: 10px;
            background: #f8f9fa;
            padding: 5px;
            border-radius: 8px;
        }

        .view-toggle button {
            padding: 8px 16px;
            font-size: 14px;
            background: white;
            color: #667eea;
        }

        .view-toggle button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-bottom: 30px;
        }

        .gallery-container {
            margin-bottom: 30px;
        }

        .gallery-reference {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .gallery-reference h4 {
            color: #333;
            font-size: 1.2em;
            font-weight: 600;
            margin: 0;
        }

        .gallery-reference-img {
            width: 150px;
            height: 150px;
            position: relative;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .gallery-reference-img:hover {
            transform: scale(1.05);
        }

        .gallery-reference-img img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .gallery-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .gallery-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }

        .gallery-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .gallery-item-title {
            font-weight: 600;
            color: #333;
        }

        .gallery-images {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .gallery-img-wrapper {
            position: relative;
            padding-bottom: 100%;
            background: white;
            border-radius: 5px;
            overflow: hidden;
            cursor: pointer;
        }

        .gallery-img-wrapper img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .gallery-img-label {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 3px;
            font-size: 0.7em;
            text-align: center;
        }

        .image-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .image-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .image-card h3 {
            text-align: center;
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .image-wrapper {
            position: relative;
            width: 100%;
            padding-bottom: 100%;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
        }

        .image-wrapper img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: transform 0.3s;
        }

        .image-wrapper:hover img {
            transform: scale(1.05);
        }

        .image-info {
            margin-top: 10px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }

        .stats {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            text-align: center;
        }

        .stat-item {
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 40px;
            color: white;
            font-size: 40px;
            cursor: pointer;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #667eea;
        }

        .error {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #e74c3c;
        }

        @media (max-width: 1200px) {
            .comparison-grid, .gallery-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé≠ DreamID-V ‰∫∫ËáâÁΩÆÊèõÊïàÊûúÊØîËºÉ</h1>
        
        <div class="controls">
            <div class="control-group">
                <label>Ê™¢Ë¶ñÊ®°Âºè:</label>
                <div class="view-toggle">
                    <button id="singleViewBtn" class="active">ÂñÆÂºµ</button>
                    <button id="galleryViewBtn">Â§öÂºµ</button>
                </div>
            </div>

            <div class="control-group">
                <label for="folderSelect">ÈÅ∏ÊìáË≥áÊñôÂ§æ:</label>
                <select id="folderSelect">
                    <option value="Show-o">Show-o</option>
                    <option value="Pixart">Pixart</option>
                    <option value="Janus">Janus</option>
                    <option value="Infinity">Infinity</option>
                </select>
            </div>

            <div class="control-group" id="singleViewControls">
                <label for="imageSelect">ÈÅ∏ÊìáÂúñÁâá:</label>
                <select id="imageSelect"></select>
            </div>

            <div class="control-group" id="singleViewNav">
                <label>&nbsp;</label>
                <div style="display: flex; gap: 10px;">
                    <button id="prevBtn">‚Üê ‰∏ä‰∏ÄÂºµ</button>
                    <button id="nextBtn">‰∏ã‰∏ÄÂºµ ‚Üí</button>
                </div>
            </div>

            <div class="control-group">
                <label>&nbsp;</label>
                <button id="refreshBtn">üîÑ ÈáçÊñ∞ËºâÂÖ•</button>
            </div>
        </div>

        <div id="loadingMsg" class="loading">ËºâÂÖ•‰∏≠...</div>
        <div id="errorMsg" class="error" style="display: none;"></div>

        <div id="comparisonContent" style="display: none;">
            <!-- Single View -->
            <div id="singleView" class="comparison-grid">
                <div class="image-card">
                    <h3>üì∑ ÂéüÂßãÂúñÁâá</h3>
                    <div class="image-wrapper" onclick="openModal('original')">
                        <img id="originalImg" src="" alt="ÂéüÂßãÂúñÁâá">
                    </div>
                    <div class="image-info" id="originalInfo"></div>
                </div>

                <div class="image-card">
                    <h3>üë§ ÂèÉËÄÉ‰∫∫Ëáâ</h3>
                    <div class="image-wrapper" onclick="openModal('reference')">
                        <img id="referenceImg" src="" alt="ÂèÉËÄÉ‰∫∫Ëáâ">
                    </div>
                    <div class="image-info" id="referenceInfo"></div>
                </div>

                <div class="image-card">
                    <h3>‚ú® ÁΩÆÊèõÁµêÊûú</h3>
                    <div class="image-wrapper" onclick="openModal('result')">
                        <img id="resultImg" src="" alt="ÁΩÆÊèõÁµêÊûú">
                    </div>
                    <div class="image-info" id="resultInfo"></div>
                </div>
            </div>

            <!-- Gallery View -->
            <div id="galleryView" class="gallery-container" style="display: none;">
                <div class="gallery-reference">
                    <h4>üë§ ÂèÉËÄÉ‰∫∫Ëáâ</h4>
                    <div class="gallery-reference-img" onclick="openModalWithSrc('../paul_ref_images/0.png')">
                        <img src="../paul_ref_images/0.png" alt="ÂèÉËÄÉ‰∫∫Ëáâ" onerror="this.style.display='none'">
                    </div>
                </div>
                <div id="galleryGrid" class="gallery-grid"></div>
            </div>

            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalCount">0</div>
                    <div class="stat-label">Á∏ΩÂúñÁâáÊï∏</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="currentIndex">0</div>
                    <div class="stat-label">Áï∂ÂâçÂ∫èËôü</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="folderCount">4</div>
                    <div class="stat-label">Ë≥áÊñôÂ§æÊï∏</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="currentFolder">-</div>
                    <div class="stat-label">Áï∂ÂâçË≥áÊñôÂ§æ</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="imageModal" onclick="closeModal()">
        <span class="modal-close">&times;</span>
        <img id="modalImg" src="" alt="ÊîæÂ§ßÊ™¢Ë¶ñ">
    </div>

    <script>
        let currentFolder = 'Show-o';
        let currentImageIndex = 0;
        let imageList = [];
        let viewMode = 'single';
        const imageNumbers = Array.from({length: 20}, (_, i) => i);

        function init() {
            loadImageList();
            document.getElementById('folderSelect').addEventListener('change', onFolderChange);
            document.getElementById('imageSelect').addEventListener('change', onImageChange);
            document.getElementById('prevBtn').addEventListener('click', showPrevImage);
            document.getElementById('nextBtn').addEventListener('click', showNextImage);
            document.getElementById('refreshBtn').addEventListener('click', init);
            document.getElementById('singleViewBtn').addEventListener('click', () => switchView('single'));
            document.getElementById('galleryViewBtn').addEventListener('click', () => switchView('gallery'));

            document.addEventListener('keydown', (e) => {
                if (viewMode === 'single') {
                    if (e.key === 'ArrowLeft') showPrevImage();
                    if (e.key === 'ArrowRight') showNextImage();
                }
                if (e.key === 'Escape') closeModal();
            });
        }

        function switchView(mode) {
            viewMode = mode;
            document.getElementById('singleViewBtn').classList.toggle('active', mode === 'single');
            document.getElementById('galleryViewBtn').classList.toggle('active', mode === 'gallery');
            document.getElementById('singleViewControls').style.display = mode === 'single' ? 'flex' : 'none';
            document.getElementById('singleViewNav').style.display = mode === 'single' ? 'flex' : 'none';
            document.getElementById('singleView').style.display = mode === 'single' ? 'grid' : 'none';
            document.getElementById('galleryView').style.display = mode === 'gallery' ? 'grid' : 'none';
            
            if (mode === 'single') {
                loadCurrentImage();
            } else {
                loadGalleryView();
            }
        }

        function loadImageList() {
            imageList = imageNumbers;
            populateImageSelect();
            updateStats();
            if (viewMode === 'single') {
                loadCurrentImage();
            } else {
                loadGalleryView();
            }
        }

        function populateImageSelect() {
            const select = document.getElementById('imageSelect');
            select.innerHTML = '';
            imageList.forEach((num, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `ÂúñÁâá ${num}.png`;
                select.appendChild(option);
            });
            select.value = currentImageIndex;
        }

        function onFolderChange() {
            currentFolder = document.getElementById('folderSelect').value;
            currentImageIndex = 0;
            loadImageList();
        }

        function onImageChange() {
            currentImageIndex = parseInt(document.getElementById('imageSelect').value);
            loadCurrentImage();
        }

        function showPrevImage() {
            if (currentImageIndex > 0) {
                currentImageIndex--;
                document.getElementById('imageSelect').value = currentImageIndex;
                loadCurrentImage();
            }
        }

        function showNextImage() {
            if (currentImageIndex < imageList.length - 1) {
                currentImageIndex++;
                document.getElementById('imageSelect').value = currentImageIndex;
                loadCurrentImage();
            }
        }

        function updateNavButtons() {
            document.getElementById('prevBtn').disabled = currentImageIndex === 0;
            document.getElementById('nextBtn').disabled = currentImageIndex === imageList.length - 1;
        }

        function loadCurrentImage() {
            const imageNum = imageList[currentImageIndex];
            const originalBasePath = `../paul_target_images/${currentFolder}/${imageNum}`;
            const referencePath = `../paul_ref_images/0.png`;
            const resultBasePath = `${currentFolder}/swapped_${imageNum}`;

            document.getElementById('loadingMsg').style.display = 'block';
            document.getElementById('comparisonContent').style.display = 'none';
            document.getElementById('errorMsg').style.display = 'none';

            Promise.all([
                tryLoadImageWithFormats('originalImg', originalBasePath, ['jpg', 'png']),
                loadImage('referenceImg', referencePath),
                tryLoadImageWithFormats('resultImg', resultBasePath, ['jpg', 'png'])
            ]).then(([originalInfo, referenceInfo, resultInfo]) => {
                const originalExt = originalInfo.src.split('.').pop();
                const resultExt = resultInfo.src.split('.').pop();
                document.getElementById('loadingMsg').style.display = 'none';
                document.getElementById('comparisonContent').style.display = 'block';
                document.getElementById('originalInfo').textContent = `${imageNum}.${originalExt} (${originalInfo.width}√ó${originalInfo.height})`;
                document.getElementById('referenceInfo').textContent = `0.png (${referenceInfo.width}√ó${referenceInfo.height})`;
                document.getElementById('resultInfo').textContent = `swapped_${imageNum}.${resultExt} (${resultInfo.width}√ó${resultInfo.height})`;
                updateStats();
                updateNavButtons();
            }).catch(error => {
                document.getElementById('loadingMsg').style.display = 'none';
                document.getElementById('errorMsg').textContent = `ËºâÂÖ•ÂúñÁâáÂ§±Êïó: ${error.message}`;
                document.getElementById('errorMsg').style.display = 'block';
            });
        }

        function loadImage(imgId, src) {
            return new Promise((resolve, reject) => {
                const img = document.getElementById(imgId);
                img.onload = () => resolve({src, width: img.naturalWidth, height: img.naturalHeight});
                img.onerror = () => reject(new Error(`ÁÑ°Ê≥ïËºâÂÖ•: ${src}`));
                img.src = src;
            });
        }

        function tryLoadImageWithFormats(imgId, basePath, extensions = ['jpg', 'png']) {
            return new Promise((resolve, reject) => {
                let index = 0;
                const tryNext = () => {
                    if (index >= extensions.length) {
                        reject(new Error(`ÁÑ°Ê≥ïËºâÂÖ•: ${basePath}`));
                        return;
                    }
                    const ext = extensions[index];
                    const src = `${basePath}.${ext}`;
                    const img = document.getElementById(imgId);
                    img.onload = () => resolve({src, width: img.naturalWidth, height: img.naturalHeight});
                    img.onerror = () => {
                        index++;
                        tryNext();
                    };
                    img.src = src;
                };
                tryNext();
            });
        }

        function loadGalleryView() {
            const gallery = document.getElementById('galleryGrid');
            gallery.innerHTML = '';
            
            document.getElementById('loadingMsg').style.display = 'block';
            document.getElementById('comparisonContent').style.display = 'none';
            
            imageList.forEach((imageNum) => {
                const item = document.createElement('div');
                item.className = 'gallery-item';
                
                const originalPathJpg = `../paul_target_images/${currentFolder}/${imageNum}.jpg`;
                const originalPathPng = `../paul_target_images/${currentFolder}/${imageNum}.png`;
                const resultPathJpg = `${currentFolder}/swapped_${imageNum}.jpg`;
                const resultPathPng = `${currentFolder}/swapped_${imageNum}.png`;
                
                item.innerHTML = `
                    <div class="gallery-item-header">
                        <div class="gallery-item-title">ÂúñÁâá ${imageNum}</div>
                    </div>
                    <div class="gallery-images">
                        <div class="gallery-img-wrapper">
                            <img src="${originalPathJpg}" alt="ÂéüÂßã" 
                                 onerror="this.onerror=null; this.src='${originalPathPng}'; this.onerror=function(){this.style.display='none'};" 
                                 onload="this.nextElementSibling.textContent='ÂéüÂßã ('+this.naturalWidth+'√ó'+this.naturalHeight+')';"
                                 onclick="openModalWithSrc(this.src)">
                            <div class="gallery-img-label">ÂéüÂßã</div>
                        </div>
                        <div class="gallery-img-wrapper">
                            <img src="${resultPathJpg}" alt="ÁµêÊûú" 
                                 onerror="this.onerror=null; this.src='${resultPathPng}'; this.onerror=function(){this.style.display='none'};" 
                                 onload="this.nextElementSibling.textContent='ÁµêÊûú ('+this.naturalWidth+'√ó'+this.naturalHeight+')';"
                                 onclick="openModalWithSrc(this.src)">
                            <div class="gallery-img-label">ÁµêÊûú</div>
                        </div>
                    </div>
                `;
                
                gallery.appendChild(item);
            });
            
            document.getElementById('loadingMsg').style.display = 'none';
            document.getElementById('comparisonContent').style.display = 'block';
            updateStats();
        }

        function updateStats() {
            document.getElementById('totalCount').textContent = imageList.length;
            document.getElementById('currentIndex').textContent = viewMode === 'single' ? currentImageIndex + 1 : '-';
            document.getElementById('currentFolder').textContent = currentFolder;
        }

        function openModal(type) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImg');
            
            if (type === 'original') {
                modalImg.src = document.getElementById('originalImg').src;
            } else if (type === 'reference') {
                modalImg.src = document.getElementById('referenceImg').src;
            } else {
                modalImg.src = document.getElementById('resultImg').src;
            }
            
            modal.classList.add('active');
        }

        function openModalWithSrc(src) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImg');
            modalImg.src = src;
            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('imageModal').classList.remove('active');
        }

        init();
    </script>
</body>
</html>
